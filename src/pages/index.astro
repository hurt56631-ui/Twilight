---
import GridLayout from "@layouts/grid.astro";

// 1. 顶部 4 个拼音基础模块
const pinyinNav = [
  { zh: "声母", mm: "ဗျည်း", icon: "mic", href: "/pinyin/initials", bg: "rgba(37,99,235,0.1)", iconColor: "text-blue-600" },
  { zh: "韵母", mm: "သရ", icon: "music", href: "/pinyin/finals", bg: "rgba(5,150,105,0.1)", iconColor: "text-emerald-600" },
  { zh: "整体", mm: "အသံတွဲ", icon: "layers", href: "/pinyin/syllables", bg: "rgba(147,51,234,0.1)", iconColor: "text-purple-600" },
  { zh: "声调", mm: "အသံ", icon: "document", href: "/pinyin/tones", bg: "rgba(234,88,12,0.1)", iconColor: "text-orange-600" },
];

// 2. 中间 4 个核心工具模块（免费书籍改成跳转 /library）
const coreTools = [
  { zh: "AI 翻译", mm: "AI ဘာသာပြန်", icon: "globe", href: "/ai-translate", bg: "rgba(79,70,229,0.1)", iconColor: "text-indigo-600" },
  { zh: "免费书籍", mm: "စာကြည့်တိုက်", icon: "books", href: "/library", bg: "rgba(8,145,178,0.1)", iconColor: "text-cyan-600" },
  { zh: "单词收藏", mm: "မှတ်ထားသော စာလုံး", icon: "star", href: "/words", bg: "rgba(71,85,105,0.1)", iconColor: "text-slate-700" },
  { zh: "口语收藏", mm: "မှတ်ထားသော စကားပြော", icon: "speaker", href: "/oral", bg: "rgba(71,85,105,0.1)", iconColor: "text-slate-700" },
];

// 3. 底部带背景图的系统课程
const systemCourses = [
  {
    badge: "Words",
    sub: "词汇 (VOCABULARY)",
    title: "日常高频词汇",
    mmDesc: "အခြေခံ စကားလုံးများကို လေ့လာပါ。",
    zhDesc: "掌握生活与考试中最核心的词汇",
    bgImg: "https://images.unsplash.com/photo-1456513080510-7bf3a84b82f8?auto=format&fit=crop&q=80&w=800",
    fallbackBg: "bg-blue-900",
    href: "/course/words"
  },
  {
    badge: "Spoken",
    sub: "口语 (ORAL)",
    title: "地道汉语口语",
    mmDesc: "နေ့စဉ်သုံး စကားပြောဆိုမှုများကို လေ့ကျင့်ပါ。",
    zhDesc: "跟读与练习最纯正的日常交流口语",
    bgImg: "https://images.unsplash.com/photo-1528712306091-ed0763094c98?auto=format&fit=crop&q=80&w=800",
    fallbackBg: "bg-emerald-900",
    href: "/course/oral"
  },
  {
    badge: "HSK 1",
    sub: "入门 (INTRO)",
    title: "HSK 1",
    mmDesc: "အသုံးအများဆုံး စကားလုံးများနှင့် သဒ္ဒါ",
    zhDesc: "掌握最常用词语和基本语法",
    bgImg: "https://images.unsplash.com/photo-1548013146-72479768bada?auto=format&fit=crop&q=80&w=800",
    fallbackBg: "bg-slate-800",
    href: "/course/hsk1"
  }
];

// SVG 图标库
const iconMap = {
  mic: { viewBox: "0 0 24 24", paths: ["M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z", "M19 10v2a7 7 0 0 1-14 0v-2", "M12 19v3"] },
  music: { viewBox: "0 0 24 24", paths: ["M9 18V5l12-2v13", "M9 9l12-2", "M6 15a3 3 0 1 0 3 3v-3H6Z", "M18 13a3 3 0 1 0 3 3v-3h-3Z"] },
  layers: { viewBox: "0 0 24 24", paths: ["M12 2L2 7l10 5 10-5-10-5Z", "M2 12l10 5 10-5", "M2 17l10 5 10-5"] },
  document: { viewBox: "0 0 24 24", paths: ["M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z", "M14 2v6h6", "M16 13H8", "M16 17H8", "M10 9H8"] },
  bulb: { viewBox: "0 0 24 24", paths: ["M9 18h6", "M10 22h4", "M15.09 14c.18-.98.65-1.74 1.41-2.5A6 6 0 1 0 8 4.92C6.35 6.2 5.56 8.35 6.07 10.34c.32 1.25.96 2.45 1.84 3.32.76.76 1.23 1.52 1.41 2.5"] },
  globe: { viewBox: "0 0 24 24", paths: ["M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z", "M2 12h20", "M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"] },
  books: { viewBox: "0 0 24 24", paths: ["M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20", "M8 7h6", "M8 11h8"] },
  star: { viewBox: "0 0 24 24", fill: "currentColor", stroke: "none", paths: ["M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"] },
  speaker: { viewBox: "0 0 24 24", fill: "currentColor", stroke: "none", paths: ["M11 5L6 9H2v6h4l5 4V5z", "M15.54 8.46a5 5 0 0 1 0 7.07", "M19.07 4.93a10 10 0 0 1 0 14.14"] }
};

const getIcon = (name) => iconMap[name] || iconMap.mic;
---

<GridLayout title="Chinese Learning Hub">
  <main class="relative mx-auto max-w-lg px-4 pb-28 pt-4 z-10">
    <section class="grid grid-cols-4 gap-3">
      {pinyinNav.map((item, index) => {
        const icon = getIcon(item.icon);
        return (
          <a href={item.href} class="glass-card flex flex-col items-center justify-center py-4 px-1 gap-2 hover:bg-white/80 card-in" style={`animation-delay: ${index * 50}ms;`}>
            <div class={`w-8 h-8 rounded-full flex items-center justify-center ${item.iconColor}`} style={`background-color: ${item.bg}`}>
              <svg viewBox={icon.viewBox} class="w-4 h-4" fill={icon.fill || "none"} stroke={icon.stroke || "currentColor"} stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                {icon.paths.map((d) => <path d={d}></path>)}
              </svg>
            </div>
            <div class="text-center">
              <div class="text-[13px] font-bold text-slate-800 leading-none mb-1">{item.zh}</div>
              <div class="text-[10px] text-slate-500 font-medium leading-none burmese-text">{item.mm}</div>
            </div>
          </a>
        );
      })}
    </section>

    <section class="mt-4 card-in" style="animation-delay: 200ms;">
      <a href="/tips" class="glass-card flex items-center justify-between px-4 py-3 hover:bg-white/80">
        <div class="flex items-center gap-3">
          <div class="w-6 h-6 text-orange-500">
            <svg viewBox={iconMap.bulb.viewBox} fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              {iconMap.bulb.paths.map((d) => <path d={d}></path>)}
            </svg>
          </div>
          <div>
            <div class="text-[14px] font-bold text-slate-800">发音技巧 (Tips)</div>
            <div class="text-[11px] text-slate-500 mt-0.5 burmese-text">အသံထွက်နည်းလမ်းများ</div>
          </div>
        </div>
        <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
      </a>
    </section>

    <section class="mt-4 grid grid-cols-2 gap-3">
      {coreTools.map((tool, index) => {
        const icon = getIcon(tool.icon);
        return (
          <a
            href={tool.href}
            class="glass-card flex items-center gap-3 p-3.5 hover:bg-white/80 card-in"
            style={`animation-delay: ${index * 50 + 250}ms;`}
          >
            <div class={`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${tool.iconColor}`} style={`background-color: ${tool.bg}`}>
              <svg viewBox={icon.viewBox} class="w-4 h-4" fill={icon.fill || "none"} stroke={icon.stroke || "currentColor"} stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                {icon.paths.map((d) => <path d={d}></path>)}
              </svg>
            </div>
            <div class="flex flex-col min-w-0">
              <span class="text-[14px] font-bold text-slate-800 truncate">{tool.zh}</span>
              <span class="text-[10px] text-slate-500 mt-0.5 truncate burmese-text">{tool.mm}</span>
            </div>
          </a>
        );
      })}
    </section>

    <section class="mt-8">
      <div class="mb-3 px-1 flex items-center gap-2">
        <svg class="w-4 h-4 text-slate-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"></path></svg>
        <h2 class="text-[13px] font-bold text-slate-700 tracking-wider burmese-text">SYSTEM COURSES (သင်ရိုး)</h2>
      </div>

      <div class="flex flex-col gap-4">
        {systemCourses.map((course, index) => (
          <a href={course.href} class={`course-card group card-in ${course.fallbackBg}`} style={`animation-delay: ${index * 100 + 400}ms;`}>
            <div class="absolute inset-0 bg-cover bg-center transition-transform duration-700 group-hover:scale-105 opacity-85" style={`background-image: url('${course.bgImg}');`}></div>
            <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-transparent"></div>
            <div class="relative h-full flex flex-col justify-between p-4 min-h-[160px]">
              <div class="flex gap-2">
                <span class="bg-white/95 text-slate-800 text-[11px] font-black px-3 py-1 rounded-full shadow-sm">{course.badge}</span>
              </div>
              <div class="mt-8">
                <p class="text-cyan-400 font-bold text-[11px] tracking-widest mb-1">{course.sub}</p>
                <h3 class="text-white font-black text-2xl mb-1.5">{course.title}</h3>
                <p class="text-slate-200 text-[13px] burmese-text mb-0.5 line-clamp-1">{course.mmDesc}</p>
                <p class="text-slate-300 text-[12px] font-medium line-clamp-1">{course.zhDesc}</p>
              </div>
            </div>
          </a>
        ))}
      </div>
    </section>
  </main>

  <nav class="app-bottom-nav sm:hidden">
    <a href="https://bbs.886.best/user/mei/chats" class="nav-item">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-[22px] h-[22px] mb-1">
        <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>
      </svg>
      <span>消息</span>
    </a>

    <a href="https://bbs.886.best" class="nav-item">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-[22px] h-[22px] mb-1">
        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
        <polyline points="9 22 9 12 15 12 15 22"></polyline>
      </svg>
      <span>社区</span>
    </a>

    <a href="https://bbs.886.best/partners" class="nav-item">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-[22px] h-[22px] mb-1">
        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
        <circle cx="9" cy="7" r="4"></circle>
        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
      </svg>
      <span>语伴</span>
    </a>

    <a href="https://bbs.886.best/category/5/%E5%8A%A8%E6%80%81" class="nav-item">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-[22px] h-[22px] mb-1">
        <circle cx="12" cy="12" r="10"></circle>
        <polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"></polygon>
      </svg>
      <span>动态</span>
    </a>

    <a href="/" class="nav-item active">
      <svg viewBox="0 0 24 24" fill="currentColor" stroke="none" class="w-[24px] h-[24px] mb-1">
        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
        <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
      </svg>
      <span>学习</span>
    </a>
  </nav>
</GridLayout>

<style is:global>
  body {
    background: url("/assets/images/desktopWallpaper_1.jpg") center / cover fixed no-repeat;
    font-family: "Noto Sans Myanmar", "Manrope", "Segoe UI", sans-serif;
  }

  body::before {
    content: "";
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 0;
    background: rgba(241, 245, 249, 0.5);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
  }

  .burmese-text {
    line-height: 1.6;
  }

  #sidebar-left,
  #sidebar-right {
    display: none !important;
  }
</style>

<style>
  .glass-card {
    border-radius: 1.25rem;
    background: rgba(255, 255, 255, 0.75);
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    border: 1px solid rgba(255, 255, 255, 0.6);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.03);
    transition: all 0.2s ease;
  }

  .course-card {
    display: block;
    position: relative;
    width: 100%;
    border-radius: 1.25rem;
    overflow: hidden;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    border: 1px solid rgba(255, 255, 255, 0.3);
    transform: translateZ(0);
  }

  .card-in {
    opacity: 0;
    animation: slideUpFade 500ms cubic-bezier(0.16, 1, 0.3, 1) forwards;
  }

  @keyframes slideUpFade {
    0% { opacity: 0; transform: translateY(15px) scale(0.98); }
    100% { opacity: 1; transform: translateY(0) scale(1); }
  }

  .app-bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 50;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-top: 1px solid rgba(0, 0, 0, 0.05);
    padding: 0 5px;
    padding-bottom: env(safe-area-inset-bottom);
    height: calc(56px + env(safe-area-inset-bottom));
  }

  .nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    flex: 1;
    height: 100%;
    color: #64748b;
    text-decoration: none;
    transition: color 0.2s;
  }

  .nav-item span {
    font-size: 10px;
    font-weight: 600;
    margin-top: 2px;
  }

  .nav-item.active {
    color: #4f46e5;
  }
</style>
